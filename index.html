<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kan - Israeli Public Broadcasting Corporation</title>
    <style>
        /* (שאר ה-CSS נשאר ללא שינוי) */
    </style>
</head>
<body>
    <!-- (תוכן ה-body נשאר ללא שינוי) -->

    <script>
        const styleSelection = document.getElementById('style-selection');
        const newsContent = document.getElementById('news-content');
        const errorMessage = document.getElementById('error-message');
        const loadingIndicator = document.getElementById('loading');

        const styleMap = {
            'curious-child': 'curious-child-news-json.json',
            'tel-aviv-elitist': 'tel-aviv-elitist-news-json.json',
            'worried-grandmother': 'worried-grandmother-news-json.json',
            'ars': 'ars-news-json.json',
            'confused-immigrant': 'confused-immigrant-news-json.json',
            'haredi-yeshiva': 'haredi-yeshiva-news-json.json',
            'conspirator': 'conspirator-news-json.json',
            'slick-politician': 'slick-politician-news-json.json',
            'startup-programmer': 'startup-programmer-json.json',
            'bibi-supporter': 'bibi-supporter-news-json.json'
        };

        styleSelection.addEventListener('click', (e) => {
            if (e.target.classList.contains('style-button')) {
                console.log('Button clicked:', e.target.textContent);
                const style = e.target.dataset.style;
                loadNewsData(styleMap[style]);
                errorMessage.textContent = '';
                loadingIndicator.style.display = 'block';
            }
        });

        function loadNewsData(jsonFile) {
            console.log('Loading news data from:', jsonFile);
            loadingIndicator.style.display = 'block';
            
            fetch(jsonFile)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    console.log('Received data:', text.substring(0, 100) + '...'); // Log the first 100 characters
                    let data;
                    if (text.startsWith('processNewsData(')) {
                        const jsonText = text.slice(16, -1); // Remove 'processNewsData(' and ')'
                        data = JSON.parse(jsonText);
                    } else {
                        data = JSON.parse(text);
                    }
                    processNewsData(data);
                })
                .catch(error => {
                    console.error('Error loading or parsing JSON:', error);
                    errorMessage.textContent = 'שגיאה בטעינת או עיבוד קובץ החדשות: ' + error.message;
                    loadingIndicator.style.display = 'none';
                });
        }

        function processNewsData(data) {
            console.log('processNewsData called with:', data);
            loadingIndicator.style.display = 'none';
            if (Array.isArray(data) && data.length > 0) {
                console.log('Valid news data received, displaying news');
                displayNews(data);
            } else {
                console.error('Invalid news data received');
                errorMessage.textContent = 'שגיאה: התקבלו נתוני חדשות לא תקינים.';
            }
        }

        function displayNews(newsItems) {
            console.log('Displaying news items:', newsItems);
            styleSelection.style.display = 'none';
            newsContent.style.display = 'block';
            newsContent.innerHTML = '';

            newsItems.forEach((item, index) => {
                console.log('Creating article for item:', item);
                const article = document.createElement('article');
                article.className = 'news-item';

                const title = document.createElement('h3');
                title.textContent = item.Title;
                article.appendChild(title);

                if (item.image_base_16x9 || item.image_base_1x1) {
                    const image = document.createElement('img');
                    image.src = index === 0 ? item.image_base_16x9 : item.image_base_1x1;
                    image.alt = item.Title;
                    article.appendChild(image);
                }

                const summary = document.createElement('p');
                summary.textContent = item.Summary;
                article.appendChild(summary);

                if (index === 0 && item.Description) {
                    const description = document.createElement('p');
                    description.textContent = item.Description;
                    article.appendChild(description);
                }

                newsContent.appendChild(article);
            });

            console.log('News content updated');
        }

        console.log('Script loaded');
    </script>
</body>
</html>
